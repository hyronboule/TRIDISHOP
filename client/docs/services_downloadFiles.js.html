<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/downloadFiles.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/downloadFiles.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import JSZip from 'jszip';
import { saveAs } from 'file-saver';
import axios from 'axios';
import jsPDF from 'jspdf';


/**
 * Downloads a list of files, generates a receipt, and saves them as a ZIP archive.
 *
 * @param {Array&lt;Object>} files - The list of files to download. Each file object should contain a `file.fileUrl` property.
 * @param {string} name - The name of the buyer.
 * @param {number} total - The total amount paid by the buyer.
 * @returns {Promise&lt;void>} - Resolves when the ZIP file is successfully generated and saved.
 */
export const downloadFiles = async (files, name, total) => {
    const zip = new JSZip();

    await Promise.all(files.map(async (file, i) => {
        try {
            const response = await axios.get(file.file.fileUrl, { responseType: 'blob' });
            if (response.status !== 200) {
                throw new Error(`Failed to fetch file: ${file.file.fileUrl}`);
            }
            zip.file(`fichier3D${i}.glb`, response.data);   //name to file 3D
        } catch (error) {
            console.error('Error downloading file:', error);
        }
    }));

    const receiptBlob = await generateReceipt(name, total, files);
    zip.file('reçu.pdf', receiptBlob);

    // generate Zip
    try {
        const content = await zip.generateAsync({ type: 'blob' });
        saveAs(content, 'fichier3D.zip');
    } catch (err) {
        console.error('Error generating ZIP:', err);
    }
}

const generateReceipt = async (buyerName, total, products) => {
    const doc = new jsPDF();

    // Title
    doc.setFontSize(18);
    doc.text("Récapitulatif de l'achat effectué", 14, 20);

    // Information of buyer
    doc.setFontSize(13);
    doc.text("Nom du client : " + buyerName, 14, 30);

    // list of products
    doc.text('Produits achetés: ', 14, 70);
    let y = 80;

    products.forEach((product) => {
        let nameProduct = product.nameFile;
        let priceProduct = product.price;

        doc.text(`Code produit : ${nameProduct} - ${priceProduct} euros`, 14, y);
        y += 10;
    });


    doc.setFontSize(14);
    doc.text(`Montant total : ${total} euros`, 14, y + 10);

    return await doc.output('blob');
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Model">Model</a></li><li><a href="global.html#View3D">View3D</a></li><li><a href="global.html#addNewProductApi">addNewProductApi</a></li><li><a href="global.html#apiCallUserProfil">apiCallUserProfil</a></li><li><a href="global.html#callApiAllProducts">callApiAllProducts</a></li><li><a href="global.html#callApiCreateProfilUser">callApiCreateProfilUser</a></li><li><a href="global.html#callApiDetailProduct">callApiDetailProduct</a></li><li><a href="global.html#callApiLogin">callApiLogin</a></li><li><a href="global.html#callApiPageProducts">callApiPageProducts</a></li><li><a href="global.html#callApiProductsUser">callApiProductsUser</a></li><li><a href="global.html#callApiRegister">callApiRegister</a></li><li><a href="global.html#callApiSearchProduct">callApiSearchProduct</a></li><li><a href="global.html#callApiServicePayment">callApiServicePayment</a></li><li><a href="global.html#callApiUpdatePoducts">callApiUpdatePoducts</a></li><li><a href="global.html#callApiUpdateUserAuth">callApiUpdateUserAuth</a></li><li><a href="global.html#deleteConfirmation">deleteConfirmation</a></li><li><a href="global.html#deleteProduct">deleteProduct</a></li><li><a href="global.html#downloadFiles">downloadFiles</a></li><li><a href="global.html#updateNameUserAllProducts">updateNameUserAllProducts</a></li><li><a href="global.html#updateProductForm">updateProductForm</a></li><li><a href="global.html#updatedUserProfil">updatedUserProfil</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Dec 14 2024 20:07:22 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
